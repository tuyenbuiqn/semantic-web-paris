{"version":3,"file":"photoviewer.js","sources":["../src/js/defaults.js","../src/js/utilities.js","../src/js/constants.js","../src/js/draggable.js","../src/js/movable.js","../src/js/resizable.js","../src/js/core.js"],"sourcesContent":["export default {\n\n  // Enable modal to drag\n  draggable: true,\n\n  // Enable modal to resize\n  resizable: true,\n\n  // Enable image to move\n  movable: true,\n\n  // Enable keyboard navigation\n  keyboard: true,\n\n  // Shows the title\n  title: true,\n\n  // Min width of modal\n  modalWidth: 320,\n\n  // Min height of modal\n  modalHeight: 320,\n\n  // Enable the page content fixed\n  fixedContent: true,\n\n  // Disable the modal size fixed\n  fixedModalSize: false,\n\n  // Disable the image viewer maximized on init\n  initMaximized: false,\n\n  // Threshold of modal to browser window\n  gapThreshold: 0.02,\n\n  // Threshold of image ratio\n  ratioThreshold: 0.1,\n\n  // Min ratio of image when zoom out\n  minRatio: 0.1,\n\n  // Max ratio of image when zoom in\n  maxRatio: 16,\n\n  // Toolbar options in header\n  headToolbar: [\n    'maximize',\n    'close'\n  ],\n\n  // Toolbar options in footer\n  footToolbar: [\n    'zoomIn',\n    'zoomOut',\n    'prev',\n    'fullscreen',\n    'next',\n    'actualSize',\n    'rotateRight'\n  ],\n\n  // Customize button icon\n  icons: {\n    minimize: 'fa fa-window-minimize',\n    maximize: 'fa fa-window-maximize',\n    close: 'fa fa-close',\n    zoomIn: 'fa fa-search-plus',\n    zoomOut: 'fa fa-search-minus',\n    prev: 'fa fa-arrow-left',\n    next: 'fa fa-arrow-right',\n    fullscreen: 'fa fa-photo',\n    actualSize: 'fa fa-arrows-alt',\n    rotateLeft: 'fa fa-rotate-left',\n    rotateRight: 'fa fa-rotate-right'\n  },\n\n  // Customize language of button title\n  i18n: {\n    minimize: 'minimize',\n    maximize: 'maximize',\n    close: 'close',\n    zoomIn: 'zoom-in(+)',\n    zoomOut: 'zoom-out(-)',\n    prev: 'prev(←)',\n    next: 'next(→)',\n    fullscreen: 'fullscreen',\n    actualSize: 'actual-size(Ctrl+Alt+0)',\n    rotateLeft: 'rotate-left(Ctrl+,)',\n    rotateRight: 'rotate-right(Ctrl+.)'\n  },\n\n  // Enable multiple instances\n  multiInstances: true,\n\n  // Enable animation\n  initAnimation: true,\n\n  // Disable modal position fixed when change images\n  fixedModalPos: false,\n\n  // Modal z-index\n  zIndex: 1090,\n\n  // Selector of drag handler\n  dragHandle: false,\n\n  // Callback events\n  callbacks: {\n    beforeOpen: $.noop,\n    opened: $.noop,\n    beforeClose: $.noop,\n    closed: $.noop,\n    beforeChange: $.noop,\n    changed: $.noop\n  },\n\n  // Start images index\n  index: 0\n\n}\n","/**\n * [getImgSrc]\n * @param {[Object]}  el    [description]\n */\nexport function getImgSrc(el) {\n  // Get data-src as image src at first\n  let src = $(el).attr('data-src') ? $(el).attr('data-src') : $(el).attr('href');\n  return src;\n}\n\n/**\n * [throttle]\n * @param  {Function} fn    [description]\n * @param  {[Number]} delay [description]\n * @return {Function}       [description]\n */\nexport function throttle(fn, delay) {\n\n  let timer = null;\n\n  return function () {\n    let context = this,\n      args = arguments;\n\n    clearTimeout(timer);\n\n    timer = setTimeout(function () {\n      fn.apply(context, args);\n    }, delay);\n  };\n\n}\n\n/**\n * [preloadImg]\n * @param  {[String]}  src      [image src]\n * @param  {Function}  success  [callbacks]\n * @param  {Function}  error    [callbacks]\n */\nexport function preloadImg(src, success, error) {\n\n  let img = new Image();\n\n  img.onload = function () {\n    success(img);\n  };\n\n  img.onerror = function () {\n    error(img);\n  };\n\n  img.src = src;\n\n}\n\n/**\n * [requestFullscreen]\n * @param  {[type]} element [description]\n */\nexport function requestFullscreen(element) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  }\n}\n\n/**\n * [exitFullscreen]\n */\nexport function exitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.mozCancelFullScreen) {\n    document.mozCancelFullScreen();\n  } else if (document.webkitExitFullscreen) {\n    document.webkitExitFullscreen();\n  }\n}\n\n/**\n * [getImageNameFromUrl]\n * @param  {[String]} url [description]\n * @return {[String]}     [description]\n */\nexport function getImageNameFromUrl(url) {\n  let reg = /^.*?\\/*([^/?]*)\\.[a-z]+(\\?.+|$)/ig,\n    txt = url.replace(reg, '$1');\n  return txt;\n}\n\n/**\n * [getNumFromCSSValue]\n * @param  {[String]} value [description]\n * @return {[Number]}       [description]\n */\nexport function getNumFromCSSValue(value) {\n  let reg = /\\d+/g,\n    arr = value.match(reg),\n    num = parseFloat(arr[0]);\n  return num;\n}\n\n/**\n * [hasScrollbar]\n * @return {[Boolean]}       [description]\n */\nexport function hasScrollbar() {\n  return document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight);\n}\n\n/**\n * [getScrollbarWidth]\n * @return {[Number]}       [description]\n */\nexport function getScrollbarWidth() {\n\n  let scrollDiv = document.createElement('div');\n  scrollDiv.style.cssText = 'width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';\n  document.body.appendChild(scrollDiv);\n  let scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n  document.body.removeChild(scrollDiv);\n\n  return scrollbarWidth;\n\n}\n\n/**\n * [setGrabCursor]\n * @param {[Object]}  imageData    [description]\n * @param {[Object]}  stageData    [description]\n * @param {[Object]}  stage        [description]\n * @param {[Boolean]} isRotate     [description]\n */\nexport function setGrabCursor(imageData, stageData, stage, isRotated) {\n\n  let imageWidth = !isRotated ? imageData.w : imageData.h,\n    imageHeight = !isRotated ? imageData.h : imageData.w;\n\n  if (imageHeight > stageData.h || imageWidth > stageData.w) {\n    stage.addClass('is-grab');\n  }\n  if (imageHeight <= stageData.h && imageWidth <= stageData.w) {\n    stage.removeClass('is-grab');\n  }\n}\n\n/**\n * [supportTouch]\n * @return {[Boolean]}     [description]\n */\nexport function supportTouch() {\n  return !!(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch);\n}\n","import defaults from './defaults';\nimport { supportTouch } from './utilities';\n\nexport const $W = $(window);\nexport const $D = $(document);\n\nexport const CLICK_EVENT = 'click';\nexport const RESIZE_EVENT = 'resize';\nexport const KEYDOWN_EVENT = 'keydown';\nexport const WHEEL_EVENT = 'wheel mousewheel DOMMouseScroll';\n\nexport const TOUCH_START_EVENT = supportTouch() ? 'touchstart' : 'mousedown';\nexport const TOUCH_MOVE_EVENT = supportTouch() ? 'touchmove' : 'mousemove';\nexport const TOUCH_END_EVENT = supportTouch() ? 'touchend' : 'mouseup';\n\nexport const NS = 'photoviewer';\nexport const CLASS_NS = '.' + NS;\nexport const EVENT_NS = '.' + NS;\n\nexport const PUBLIC_VARS = {\n  // image moving flag\n  isMoving: false,\n  // modal resizing flag\n  isResizing: false,\n  // modal z-index setting\n  zIndex: defaults.zIndex,\n};\n","import {\n  $D,\n  TOUCH_START_EVENT,\n  TOUCH_MOVE_EVENT,\n  TOUCH_END_EVENT,\n  EVENT_NS,\n  PUBLIC_VARS\n} from './constants';\n\nexport default {\n\n  /**\n   * [draggable]\n   * @param  {[Object]} modal       [the modal element]\n   * @param  {[Object]} dragHandle  [the handle element when dragging]\n   * @param  {[Object]} dragCancel  [the cancel element when dragging]\n   */\n  draggable(modal, dragHandle, dragCancel) {\n\n    let self = this;\n\n    let isDragging = false;\n\n    let startX = 0,\n      startY = 0,\n\n      left = 0,\n      top = 0;\n\n    let dragStart = function (e) {\n\n      e = e || window.event;\n\n      // Must be removed\n      // e.preventDefault();\n\n      if (self.options.multiInstances) {\n        modal.css('z-index', ++PUBLIC_VARS['zIndex']);\n      }\n\n      // Get clicked button\n      let elemCancel = $(e.target).closest(dragCancel);\n      // Stop modal moving when click buttons\n      if (elemCancel.length) {\n        return true;\n      }\n\n      isDragging = true;\n\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n      left = $(modal).offset().left;\n      top = $(modal).offset().top;\n\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n    };\n\n    let dragMove = function (e) {\n\n      e = e || window.event;\n\n      e.preventDefault();\n\n      if (isDragging && !PUBLIC_VARS['isMoving'] && !PUBLIC_VARS['isResizing'] && !self.isMaximized) {\n\n        let endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX,\n          endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY,\n\n          relativeX = endX - startX,\n          relativeY = endY - startY;\n\n        $(modal).css({\n          left: relativeX + left + 'px',\n          top: relativeY + top + 'px'\n        });\n\n      }\n\n    };\n\n    let dragEnd = function () {\n\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n      isDragging = false;\n\n    };\n\n    $(dragHandle).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n\n  }\n\n}\n","import {\n  $D,\n  TOUCH_START_EVENT,\n  TOUCH_MOVE_EVENT,\n  TOUCH_END_EVENT,\n  NS,\n  EVENT_NS,\n  PUBLIC_VARS\n} from './constants';\n\nconst ELEMS_WITH_GRABBING_CURSOR = `html,body,.${NS}-modal,.${NS}-stage,.${NS}-button,.${NS}-resizable-handle`;\n\nexport default {\n\n  /**\n   * --------------------------------------\n   * 1.no movable\n   * 2.vertical movable\n   * 3.horizontal movable\n   * 4.vertical & horizontal movable\n   * --------------------------------------\n   *\n   * [image movable]\n   * @param  {[Object]} stage   [the stage element]\n   * @param  {[Object]} image   [the image element]\n   */\n  movable(stage, image) {\n\n    let self = this;\n\n    let isDragging = false;\n\n    let startX = 0,\n      startY = 0,\n\n      left = 0,\n      top = 0,\n\n      widthDiff = 0,\n      heightDiff = 0,\n\n      δ = 0;\n\n    let dragStart = function (e) {\n\n      e = e || window.event;\n\n      e.preventDefault();\n\n      let imageWidth = $(image).width(),\n        imageHeight = $(image).height(),\n        stageWidth = $(stage).width(),\n        stageHeight = $(stage).height();\n\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n      // δ is the difference between image width and height\n      δ = !self.isRotated ? 0 : (imageWidth - imageHeight) / 2;\n\n      // Width or height difference can be use to limit image right or top position\n      widthDiff = !self.isRotated ? (imageWidth - stageWidth) : (imageHeight - stageWidth);\n      heightDiff = !self.isRotated ? (imageHeight - stageHeight) : (imageWidth - stageHeight);\n\n      // Modal can be dragging if image is smaller to stage\n      isDragging = (widthDiff > 0 || heightDiff > 0) ? true : false;\n      PUBLIC_VARS['isMoving'] = (widthDiff > 0 || heightDiff > 0) ? true : false;\n\n      // Reclac the element position when mousedown\n      // Fixed the issue of stage with a border\n      left = $(image).position().left - δ;\n      top = $(image).position().top + δ;\n\n      // Add grabbing cursor\n      if (stage.hasClass('is-grab')) {\n        $(ELEMS_WITH_GRABBING_CURSOR).addClass('is-grabbing');\n      }\n\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n    };\n\n    let dragMove = function (e) {\n\n      e = e || window.event;\n\n      e.preventDefault();\n\n      if (isDragging) {\n\n        let endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX,\n          endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY,\n\n          relativeX = endX - startX,\n          relativeY = endY - startY,\n\n          newLeft = relativeX + left,\n          newTop = relativeY + top;\n\n        // vertical limit\n        if (heightDiff > 0) {\n\n          if ((relativeY + top) > δ) {\n            newTop = δ;\n          } else if ((relativeY + top) < -heightDiff + δ) {\n            newTop = -heightDiff + δ;\n          }\n\n        } else {\n          newTop = top;\n        }\n        // horizontal limit\n        if (widthDiff > 0) {\n\n          if ((relativeX + left) > -δ) {\n            newLeft = -δ;\n          } else if ((relativeX + left) < -widthDiff - δ) {\n            newLeft = -widthDiff - δ;\n          }\n\n        } else {\n          newLeft = left;\n        }\n\n        $(image).css({\n          left: newLeft + 'px',\n          top: newTop + 'px'\n        });\n\n        // Update image initial data\n        $.extend(self.imageData, {\n          left: newLeft,\n          top: newTop\n        });\n\n      }\n\n    };\n\n    let dragEnd = function () {\n\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n      isDragging = false;\n      PUBLIC_VARS['isMoving'] = false;\n\n      // Remove grabbing cursor\n      $(ELEMS_WITH_GRABBING_CURSOR).removeClass('is-grabbing');\n\n    };\n\n    $(stage).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n\n  }\n\n}\n","import {\n  $D,\n  TOUCH_START_EVENT,\n  TOUCH_MOVE_EVENT,\n  TOUCH_END_EVENT,\n  NS,\n  EVENT_NS,\n  PUBLIC_VARS\n} from './constants';\n\nimport {\n  setGrabCursor\n} from './utilities';\n\nconst ELEMS_WITH_RESIZE_CURSOR = `html,body,.${NS}-modal,.${NS}-stage,.${NS}-button`;\n\nexport default {\n\n  /**\n   * ------------------------------\n   * 1.modal resizable\n   * 2.keep image in stage center\n   * 3.other image limitations\n   * ------------------------------\n   *\n   * [resizable]\n   * @param  {[Object]} modal       [the modal element]\n   * @param  {[Object]} stage       [the stage element]\n   * @param  {[Object]} image       [the image element]\n   * @param  {[Number]} minWidth    [the option of modalWidth]\n   * @param  {[Number]} minHeight   [the option of modalHeight]\n   */\n  resizable(modal, stage, image, minWidth, minHeight) {\n\n    let self = this;\n\n    let resizableHandleE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-e\"></div>`),\n      resizableHandleW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-w\"></div>`),\n      resizableHandleS = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-s\"></div>`),\n      resizableHandleN = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-n\"></div>`),\n      resizableHandleSE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-se\"></div>`),\n      resizableHandleSW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-sw\"></div>`),\n      resizableHandleNE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-ne\"></div>`),\n      resizableHandleNW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-nw\"></div>`);\n\n    let resizableHandles = {\n      'e': resizableHandleE,\n      's': resizableHandleS,\n      'se': resizableHandleSE,\n      'n': resizableHandleN,\n      'w': resizableHandleW,\n      'nw': resizableHandleNW,\n      'ne': resizableHandleNE,\n      'sw': resizableHandleSW\n    };\n\n    $(modal).append(\n      resizableHandleE, resizableHandleW, resizableHandleS, resizableHandleN,\n      resizableHandleSE, resizableHandleSW, resizableHandleNE, resizableHandleNW\n    );\n\n    let isDragging = false;\n\n    let startX = 0,\n      startY = 0,\n\n      modalData = {\n        w: 0,\n        h: 0,\n        l: 0,\n        t: 0\n      },\n      stageData = {\n        w: 0,\n        h: 0,\n        l: 0,\n        t: 0\n      },\n      imageData = {\n        w: 0,\n        h: 0,\n        l: 0,\n        t: 0\n      },\n\n      // δ is the difference between image width and height\n      δ = 0,\n      imgWidth = 0,\n      imgHeight = 0,\n\n      direction = '';\n\n    // modal CSS options\n    let getModalOpts = function (dir, offsetX, offsetY) {\n\n      // Modal should not move when its width to the minwidth\n      let modalLeft = (-offsetX + modalData.w) > minWidth ? (offsetX + modalData.l) : (modalData.l + modalData.w - minWidth),\n        modalTop = (-offsetY + modalData.h) > minHeight ? (offsetY + modalData.t) : (modalData.t + modalData.h - minHeight);\n\n      let opts = {\n        'e': {\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px'\n        },\n        's': {\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px'\n        },\n        'se': {\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px',\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px'\n        },\n        'w': {\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\n          left: modalLeft + 'px'\n        },\n        'n': {\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\n          top: modalTop + 'px'\n        },\n        'nw': {\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\n          top: modalTop + 'px',\n          left: modalLeft + 'px'\n        },\n        'ne': {\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px',\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\n          top: modalTop + 'px'\n        },\n        'sw': {\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px',\n          left: modalLeft + 'px'\n        }\n      };\n\n      return opts[dir];\n    };\n\n    // image CSS options\n    let getImageOpts = function (dir, offsetX, offsetY) {\n\n      // Image should not move when modal width to the min width\n      // The minwidth is modal width, so we should clac the stage minwidth\n      let widthDiff = (offsetX + modalData.w) > minWidth ? (stageData.w - imgWidth + offsetX - δ) : (minWidth - (modalData.w - stageData.w) - imgWidth - δ),\n        heightDiff = (offsetY + modalData.h) > minHeight ? (stageData.h - imgHeight + offsetY + δ) : (minHeight - (modalData.h - stageData.h) - imgHeight + δ),\n\n        widthDiff2 = (-offsetX + modalData.w) > minWidth ? (stageData.w - imgWidth - offsetX - δ) : (minWidth - (modalData.w - stageData.w) - imgWidth - δ),\n        heightDiff2 = (-offsetY + modalData.h) > minHeight ? (stageData.h - imgHeight - offsetY + δ) : (minHeight - (modalData.h - stageData.h) - imgHeight + δ);\n\n      // Get image position in dragging\n      let imgLeft = (widthDiff > 0 ? $(image).position().left : ($(image).position().left < 0 ? $(image).position().left : 0)) - δ,\n        imgTop = (heightDiff > 0 ? $(image).position().top : ($(image).position().top < 0 ? $(image).position().top : 0)) + δ,\n\n        imgLeft2 = (widthDiff2 > 0 ? $(image).position().left : ($(image).position().left < 0 ? $(image).position().left : 0)) - δ,\n        imgTop2 = (heightDiff2 > 0 ? $(image).position().top : ($(image).position().top < 0 ? $(image).position().top : 0)) + δ;\n\n      let opts = {\n        'e': {\n          left: widthDiff >= -δ ? ((widthDiff - δ) / 2 + 'px') : (imgLeft > widthDiff ? (imgLeft + 'px') : (widthDiff + 'px'))\n        },\n        's': {\n          top: heightDiff >= δ ? ((heightDiff + δ) / 2 + 'px') : (imgTop > heightDiff ? (imgTop + 'px') : (heightDiff + 'px'))\n        },\n        'se': {\n          top: heightDiff >= δ ? ((heightDiff + δ) / 2 + 'px') : (imgTop > heightDiff ? (imgTop + 'px') : (heightDiff + 'px')),\n          left: widthDiff >= -δ ? ((widthDiff - δ) / 2 + 'px') : (imgLeft > widthDiff ? (imgLeft + 'px') : (widthDiff + 'px'))\n        },\n        'w': {\n          left: widthDiff2 >= -δ ? ((widthDiff2 - δ) / 2 + 'px') : (imgLeft2 > widthDiff2 ? (imgLeft2 + 'px') : (widthDiff2 + 'px'))\n        },\n        'n': {\n          top: heightDiff2 >= δ ? ((heightDiff2 + δ) / 2 + 'px') : (imgTop2 > heightDiff2 ? (imgTop2 + 'px') : (heightDiff2 + 'px'))\n        },\n        'nw': {\n          top: heightDiff2 >= δ ? ((heightDiff2 + δ) / 2 + 'px') : (imgTop2 > heightDiff2 ? (imgTop2 + 'px') : (heightDiff2 + 'px')),\n          left: widthDiff2 >= -δ ? ((widthDiff2 - δ) / 2 + 'px') : (imgLeft2 > widthDiff2 ? (imgLeft2 + 'px') : (widthDiff2 + 'px'))\n        },\n        'ne': {\n          top: heightDiff2 >= δ ? ((heightDiff2 + δ) / 2 + 'px') : (imgTop2 > heightDiff2 ? (imgTop2 + 'px') : (heightDiff2 + 'px')),\n          left: widthDiff >= -δ ? ((widthDiff - δ) / 2 + 'px') : (imgLeft > widthDiff ? (imgLeft + 'px') : (widthDiff + 'px'))\n        },\n        'sw': {\n          top: heightDiff >= δ ? ((heightDiff + δ) / 2 + 'px') : (imgTop > heightDiff ? (imgTop + 'px') : (heightDiff + 'px')),\n          left: widthDiff2 >= -δ ? ((widthDiff2 - δ) / 2 + 'px') : (imgLeft2 > widthDiff2 ? (imgLeft2 + 'px') : (widthDiff2 + 'px'))\n        }\n      };\n\n      return opts[dir];\n    };\n\n    let dragStart = function (dir, e) {\n\n      e = e || window.event;\n\n      e.preventDefault();\n\n      isDragging = true;\n      PUBLIC_VARS['isResizing'] = true;\n\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n      // Reclac the modal data when mousedown\n      modalData = {\n        w: $(modal).width(),\n        h: $(modal).height(),\n        l: $(modal).offset().left,\n        t: $(modal).offset().top\n      };\n\n      stageData = {\n        w: $(stage).width(),\n        h: $(stage).height(),\n        l: $(stage).offset().left,\n        t: $(stage).offset().top\n      };\n\n      imageData = {\n        w: $(image).width(),\n        h: $(image).height(),\n        l: $(image).position().left,\n        t: $(image).position().top\n      };\n\n      // δ is the difference between image width and height\n      δ = !self.isRotated ? 0 : (imageData.w - imageData.h) / 2;\n      imgWidth = !self.isRotated ? imageData.w : imageData.h;\n      imgHeight = !self.isRotated ? imageData.h : imageData.w;\n\n      direction = dir;\n\n      // Add resizable cursor\n      $(ELEMS_WITH_RESIZE_CURSOR).css('cursor', dir + '-resize');\n\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n    };\n\n    let dragMove = function (e) {\n\n      e = e || window.event;\n\n      e.preventDefault();\n\n      if (isDragging && !self.isMaximized) {\n\n        let endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX,\n          endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY,\n\n          relativeX = endX - startX,\n          relativeY = endY - startY;\n\n        let modalOpts = getModalOpts(direction, relativeX, relativeY);\n\n        $(modal).css(modalOpts);\n\n        let imageOpts = getImageOpts(direction, relativeX, relativeY);\n\n        $(image).css(imageOpts);\n\n      }\n\n    };\n\n    let dragEnd = function () {\n\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n\n      // Set grab cursor\n      if (PUBLIC_VARS['isResizing']) {\n        setGrabCursor({ w: imgWidth, h: imgHeight }, { w: $(stage).width(), h: $(stage).height() },\n          stage\n        );\n      }\n\n      isDragging = false;\n      PUBLIC_VARS['isResizing'] = false;\n\n      // Remove resizable cursor\n      $(ELEMS_WITH_RESIZE_CURSOR).css('cursor', '');\n\n    };\n\n    $.each(resizableHandles, function (dir, handle) {\n      handle.on(TOUCH_START_EVENT + EVENT_NS, function (e) {\n        dragStart(dir, e);\n      });\n    });\n\n  }\n\n}\n","import $ from 'jquery';\r\n\r\nimport DEFAULTS from './defaults';\r\n\r\nimport {\r\n  $W,\r\n  $D,\r\n  CLICK_EVENT,\r\n  RESIZE_EVENT,\r\n  KEYDOWN_EVENT,\r\n  WHEEL_EVENT,\r\n  NS,\r\n  CLASS_NS,\r\n  EVENT_NS,\r\n  PUBLIC_VARS\r\n} from './constants';\r\n\r\nimport {\r\n  getImgSrc,\r\n  throttle,\r\n  preloadImg,\r\n  requestFullscreen,\r\n  getImageNameFromUrl,\r\n  getNumFromCSSValue,\r\n  hasScrollbar,\r\n  getScrollbarWidth,\r\n  setGrabCursor\r\n} from './utilities';\r\n\r\nimport draggable from './draggable';\r\nimport movable from './movable';\r\nimport resizable from './resizable';\r\n\r\n/**\r\n * PhotoViewer Class\r\n */\r\nclass PhotoViewer {\r\n\r\n  constructor(items, options, el) {\r\n\r\n    let self = this;\r\n\r\n    this.options = $.extend(true, {}, DEFAULTS, options);\r\n\r\n    if (options && $.isArray(options.footToolbar)) {\r\n      this.options.footToolbar = options.footToolbar;\r\n    }\r\n\r\n    if (options && $.isArray(options.headToolbar)) {\r\n      this.options.headToolbar = options.headToolbar;\r\n    }\r\n\r\n    // Store element of clicked\r\n    this.$el = $(el);\r\n\r\n    // As we have multiple instances,\r\n    // so every instance has following variables.\r\n\r\n    // modal open flag\r\n    this.isOpened = false;\r\n    // modal maximize flag\r\n    this.isMaximized = false;\r\n    // image rotate 90*(2n+1) flag\r\n    this.isRotated = false;\r\n    // image rotate angle\r\n    this.rotateAngle = 0;\r\n\r\n    // Store image data in every instance\r\n    this.imageData = {};\r\n    // Store modal data in every instance\r\n    this.modalData = {\r\n      width: null,\r\n      height: null,\r\n      left: null,\r\n      top: null\r\n    };\r\n\r\n    this.init(items, self.options, el);\r\n\r\n  }\r\n\r\n  init(items, opts, el) {\r\n\r\n    this.groupData = items;\r\n    this.groupIndex = opts['index'];\r\n\r\n    // Get image src\r\n    let imgSrc = items[this.groupIndex]['src'];\r\n\r\n    this.open();\r\n\r\n    this.loadImg(imgSrc);\r\n\r\n    // draggable & movable & resizable\r\n    if (opts.draggable) {\r\n      this.draggable(this.$photoviewer, this.dragHandle, CLASS_NS + '-button');\r\n    }\r\n    if (opts.movable) {\r\n      this.movable(this.$stage, this.$image);\r\n    }\r\n    if (opts.resizable) {\r\n      this.resizable(this.$photoviewer, this.$stage, this.$image, opts.modalWidth, opts.modalHeight);\r\n    }\r\n\r\n  }\r\n\r\n  _creatBtns(toolbar, btns) {\r\n\r\n    let btnsStr = '';\r\n\r\n    $.each(toolbar, function (index, item) {\r\n      btnsStr += btns[item];\r\n    });\r\n\r\n    return btnsStr;\r\n\r\n  }\r\n\r\n  _creatTitle() {\r\n    return (this.options.title ? `<div class=\"${NS}-title\"></div>` : '');\r\n  }\r\n\r\n  _creatDOM() {\r\n\r\n    let btnsTpl = {\r\n      minimize: `<button class=\"${NS}-button ${NS}-button-minimize\" title=\"${this.options.i18n.minimize}\">\r\n                    <i class=\"${this.options.icons.minimize}\" aria-hidden=\"true\"></i>\r\n                  </button>`,\r\n      maximize: `<button class=\"${NS}-button ${NS}-button-maximize\" title=\"${this.options.i18n.maximize}\">\r\n                    <i class=\"${this.options.icons.maximize}\" aria-hidden=\"true\"></i>\\\r\n                  </button>`,\r\n      close: `<button class=\"${NS}-button ${NS}-button-close\" title=\"${this.options.i18n.close}\">\\\r\n                <i class=\"${this.options.icons.close}\" aria-hidden=\"true\"></i>\\\r\n              </button>`,\r\n      zoomIn: `<button class=\"${NS}-button ${NS}-button-zoom-in\" title=\"${this.options.i18n.zoomIn}\">\\\r\n                  <i class=\"${this.options.icons.zoomIn}\" aria-hidden=\"true\"></i>\\\r\n                </button>`,\r\n      zoomOut: `<button class=\"${NS}-button ${NS}-button-zoom-out\" title=\"${this.options.i18n.zoomOut}\">\\\r\n                  <i class=\"${this.options.icons.zoomOut}\" aria-hidden=\"true\"></i>\\\r\n                </button>`,\r\n      prev: `<button class=\"${NS}-button ${NS}-button-prev\" title=\"${this.options.i18n.prev}\">\\\r\n                <i class=\"${this.options.icons.prev}\" aria-hidden=\"true\"></i>\\\r\n              </button>`,\r\n      next: `<button class=\"${NS}-button ${NS}-button-next\" title=\"${this.options.i18n.next}\">\\\r\n                <i class=\"${this.options.icons.next}\" aria-hidden=\"true\"></i>\\\r\n              </button>`,\r\n      fullscreen: `<button class=\"${NS}-button ${NS}-button-fullscreen\" title=\"${this.options.i18n.fullscreen}\">\\\r\n                    <i class=\"${this.options.icons.fullscreen}\" aria-hidden=\"true\"></i>\\\r\n                  </button>`,\r\n      actualSize: `<button class=\"${NS}-button ${NS}-button-actual-size\" title=\"${this.options.i18n.actualSize}\">\\\r\n                      <i class=\"${this.options.icons.actualSize}\" aria-hidden=\"true\"></i>\\\r\n                    </button>`,\r\n      rotateLeft: `<button class=\"${NS}-button ${NS}-button-rotate-left\" title=\"${this.options.i18n.rotateLeft}\">\\\r\n                      <i class=\"${this.options.icons.rotateLeft}\" aria-hidden=\"true\"></i>\\\r\n                    </button>`,\r\n      rotateRight: `<button class=\"${NS}-button ${NS}-button-rotate-right\" title=\"${this.options.i18n.rotateRight}\">\\\r\n                      <i class=\"${this.options.icons.rotateRight}\" aria-hidden=\"true\"></i>\\\r\n                    </button>`\r\n    };\r\n\r\n    // photoviewer base HTML\r\n    let photoviewerHTML = `<div class=\"${NS}-modal\">\r\n                            <div class=\"${NS}-inner\">\r\n                              <div class=\"${NS}-header\">\r\n                                <div class=\"${NS}-toolbar ${NS}-toolbar-head\">\r\n                                  ${this._creatBtns(this.options.headToolbar, btnsTpl)}\r\n                                </div>\r\n                                ${this._creatTitle()}\r\n                              </div>\r\n                              <div class=\"${NS}-stage\">\r\n                                <img class=\"${NS}-image\" src=\"\" alt=\"\" />\r\n                              </div>\r\n                              <div class=\"${NS}-footer\">\r\n                                <div class=\"${NS}-toolbar ${NS}-toolbar-foot\">\r\n                                  ${this._creatBtns(this.options.footToolbar, btnsTpl)}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </div>`;\r\n\r\n    return photoviewerHTML;\r\n\r\n  }\r\n\r\n  build() {\r\n\r\n    // Create photoviewer HTML string\r\n    let photoviewerHTML = this._creatDOM();\r\n\r\n    // Make photoviewer HTML string to jQuery element\r\n    let $photoviewer = $(photoviewerHTML);\r\n\r\n    // Get all photoviewer element\r\n    this.$photoviewer = $photoviewer;\r\n    this.$header = $photoviewer.find(CLASS_NS + '-header');\r\n    this.$headToolbar = $photoviewer.find(CLASS_NS + '-toolbar-head');\r\n    this.$footer = $photoviewer.find(CLASS_NS + '-footer');\r\n    this.$footToolbar = $photoviewer.find(CLASS_NS + '-toolbar-foot');\r\n    this.$stage = $photoviewer.find(CLASS_NS + '-stage');\r\n    this.$title = $photoviewer.find(CLASS_NS + '-title');\r\n    this.$image = $photoviewer.find(CLASS_NS + '-image');\r\n    this.$close = $photoviewer.find(CLASS_NS + '-button-close');\r\n    this.$maximize = $photoviewer.find(CLASS_NS + '-button-maximize');\r\n    this.$minimize = $photoviewer.find(CLASS_NS + '-button-minimize');\r\n    this.$zoomIn = $photoviewer.find(CLASS_NS + '-button-zoom-in');\r\n    this.$zoomOut = $photoviewer.find(CLASS_NS + '-button-zoom-out');\r\n    this.$actualSize = $photoviewer.find(CLASS_NS + '-button-actual-size');\r\n    this.$fullscreen = $photoviewer.find(CLASS_NS + '-button-fullscreen');\r\n    this.$rotateLeft = $photoviewer.find(CLASS_NS + '-button-rotate-left');\r\n    this.$rotateRight = $photoviewer.find(CLASS_NS + '-button-rotate-right');\r\n    this.$prev = $photoviewer.find(CLASS_NS + '-button-prev');\r\n    this.$next = $photoviewer.find(CLASS_NS + '-button-next');\r\n\r\n    // Add class before image loaded\r\n    this.$stage.addClass('stage-ready');\r\n    this.$image.addClass('image-ready');\r\n\r\n    // Reset modal z-index with multiple instances\r\n    this.$photoviewer.css('z-index', PUBLIC_VARS['zIndex']);\r\n\r\n    // Set handle element of draggable\r\n    if (!this.options.dragHandle || this.options.dragHandle === CLASS_NS + '-modal') {\r\n      this.dragHandle = this.$photoviewer;\r\n    } else {\r\n      this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\r\n    }\r\n\r\n  }\r\n\r\n  open() {\r\n\r\n    if (!this.options.multiInstances) {\r\n      $(CLASS_NS + '-modal').eq(0).remove();\r\n    }\r\n\r\n    // Fixed modal position bug\r\n    if (!$(CLASS_NS + '-modal').length && this.options.fixedContent) {\r\n\r\n      $('html').css({ 'overflow': 'hidden' });\r\n\r\n      if (hasScrollbar()) {\r\n        let scrollbarWidth = getScrollbarWidth();\r\n        if (scrollbarWidth) {\r\n          $('html').css({ 'padding-right': scrollbarWidth });\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.build();\r\n\r\n    this._triggerHook('beforeOpen', this.$el);\r\n\r\n    // Add PhotoViewer to DOM\r\n    $('body').append(this.$photoviewer);\r\n\r\n    this.addEvents();\r\n\r\n    this.setModalPos(this.$photoviewer);\r\n\r\n    this._triggerHook('opened', this.$el);\r\n\r\n  }\r\n\r\n  close() {\r\n\r\n    this._triggerHook('beforeClose', this.$el);\r\n\r\n    // Remove instance\r\n    this.$photoviewer.remove();\r\n\r\n    this.isOpened = false;\r\n    this.isMaximized = false;\r\n    this.isRotated = false;\r\n    this.rotateAngle = 0;\r\n\r\n    let zeroModal = !$(CLASS_NS + '-modal').length;\r\n\r\n    // Fixed modal position bug\r\n    if (zeroModal && this.options.fixedContent) {\r\n      $('html').css({ 'overflow': '', 'padding-right': '' });\r\n    }\r\n\r\n    // Reset zIndex after close\r\n    if (zeroModal && this.options.multiInstances) {\r\n      PUBLIC_VARS['zIndex'] = this.options.zIndex;\r\n    }\r\n\r\n    // off events\r\n    if (!$(CLASS_NS + '-modal').length) {\r\n      $D.off(KEYDOWN_EVENT + EVENT_NS);\r\n      $W.off(RESIZE_EVENT + EVENT_NS);\r\n    }\r\n\r\n    this._triggerHook('closed', this.$el);\r\n\r\n  }\r\n\r\n  setModalPos(modal) {\r\n\r\n    let winWidth = $W.width(),\r\n      winHeight = $W.height(),\r\n      scrollLeft = $D.scrollLeft(),\r\n      scrollTop = $D.scrollTop();\r\n\r\n    let modalWidth = this.options.modalWidth,\r\n      modalHeight = this.options.modalHeight;\r\n\r\n    // Set modal maximized when init\r\n    if (this.options.initMaximized) {\r\n\r\n      modal.addClass(NS + '-maximize');\r\n\r\n      modal.css({\r\n        width: '100%',\r\n        height: '100%',\r\n        left: 0,\r\n        top: 0\r\n      });\r\n\r\n      this.isOpened = true;\r\n      this.isMaximized = true;\r\n\r\n    } else {\r\n\r\n      // Make the modal in windows center\r\n      modal.css({\r\n        width: modalWidth,\r\n        height: modalHeight,\r\n        left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\r\n        top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n\r\n  setModalSize(img) {\r\n\r\n    let self = this,\r\n      winWidth = $W.width(),\r\n      winHeight = $W.height(),\r\n      scrollLeft = $D.scrollLeft(),\r\n      scrollTop = $D.scrollTop();\r\n\r\n    // stage css value\r\n    let stageCSS = {\r\n      left: this.$stage.css('left'),\r\n      right: this.$stage.css('right'),\r\n      top: this.$stage.css('top'),\r\n      bottom: this.$stage.css('bottom'),\r\n      borderLeft: this.$stage.css('border-left-width'),\r\n      borderRight: this.$stage.css('border-right-width'),\r\n      borderTop: this.$stage.css('border-top-width'),\r\n      borderBottom: this.$stage.css('border-bottom-width')\r\n    };\r\n\r\n    // Modal size should calc with stage css value\r\n    let modalWidth = img.width + getNumFromCSSValue(stageCSS.left) + getNumFromCSSValue(stageCSS.right) +\r\n      getNumFromCSSValue(stageCSS.borderLeft) + getNumFromCSSValue(stageCSS.borderRight),\r\n      modalHeight = img.height + getNumFromCSSValue(stageCSS.top) + getNumFromCSSValue(stageCSS.bottom) +\r\n        getNumFromCSSValue(stageCSS.borderTop) + getNumFromCSSValue(stageCSS.borderBottom);\r\n\r\n    let gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1,\r\n      // modal scale to window\r\n      scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\r\n\r\n    let minWidth = Math.max(modalWidth * scale, this.options.modalWidth),\r\n      minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\r\n\r\n    minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\r\n    minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\r\n\r\n    let modalCSSObj = {\r\n      width: minWidth + 'px',\r\n      height: minHeight + 'px',\r\n      left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\r\n      top: (winHeight - minHeight) / 2 + scrollTop + 'px'\r\n    };\r\n\r\n    // Add modal init animation\r\n    if (this.options.initAnimation) {\r\n\r\n      this.$photoviewer.animate(modalCSSObj, function () {\r\n        self.setImageSize(img);\r\n      });\r\n\r\n    } else {\r\n\r\n      this.$photoviewer.css(modalCSSObj);\r\n      this.setImageSize(img);\r\n\r\n    }\r\n\r\n    this.isOpened = true;\r\n\r\n  }\r\n\r\n  setImageSize(img) {\r\n\r\n    let stageData = {\r\n      w: this.$stage.width(),\r\n      h: this.$stage.height()\r\n    };\r\n\r\n    // image scale to stage\r\n    let scale = 1;\r\n\r\n    if (!this.isRotated) {\r\n      scale = Math.min(stageData.w / img.width, stageData.h / img.height, 1);\r\n    } else {\r\n      scale = Math.min(stageData.w / img.height, stageData.h / img.width, 1);\r\n    }\r\n\r\n    this.$image.css({\r\n      width: Math.ceil(img.width * scale) + 'px',\r\n      height: Math.ceil(img.height * scale) + 'px',\r\n      left: (stageData.w - Math.ceil(img.width * scale)) / 2 + 'px',\r\n      top: (stageData.h - Math.ceil(img.height * scale)) / 2 + 'px'\r\n    });\r\n\r\n    // Store image initial data\r\n    $.extend(this.imageData, {\r\n      width: img.width * scale,\r\n      height: img.height * scale,\r\n      left: (stageData.w - img.width * scale) / 2,\r\n      top: (stageData.h - img.height * scale) / 2\r\n    });\r\n\r\n    // Set grab cursor\r\n    setGrabCursor({ w: this.$image.width(), h: this.$image.height() }, { w: this.$stage.width(), h: this.$stage.height() },\r\n      this.$stage,\r\n      this.isRotated\r\n    );\r\n\r\n    // loader end\r\n    this.$photoviewer.find(CLASS_NS + '-loader').remove();\r\n\r\n    // Add image init animation\r\n    if (this.options.initAnimation) {\r\n      this.$image.fadeIn();\r\n    }\r\n\r\n  }\r\n\r\n  loadImg(imgSrc) {\r\n\r\n    let self = this;\r\n\r\n    let loaderHTML = `<div class=\"${NS}-loader\"></div>`;\r\n\r\n    // loader start\r\n    this.$photoviewer.append(loaderHTML);\r\n\r\n    if (this.options.initAnimation) {\r\n      this.$image.hide();\r\n    }\r\n\r\n    this.$image.attr('src', imgSrc);\r\n\r\n    preloadImg(imgSrc, function (img) {\r\n\r\n      // Store original data\r\n      self.imageData = {\r\n        originalWidth: img.width,\r\n        originalHeight: img.height\r\n      };\r\n\r\n      if (self.isMaximized || (self.isOpened && self.options.fixedModalPos)) {\r\n        self.setImageSize(img);\r\n      } else {\r\n        self.setModalSize(img);\r\n      }\r\n\r\n      self.$stage.removeClass('stage-ready');\r\n      self.$image.removeClass('image-ready');\r\n\r\n    }, function () {\r\n      // loader end\r\n      self.$photoviewer.find(CLASS_NS + '-loader').remove();\r\n    });\r\n\r\n    if (this.options.title) {\r\n      this.setImgTitle(imgSrc);\r\n    }\r\n\r\n  }\r\n\r\n  setImgTitle(url) {\r\n\r\n    let caption = this.groupData[this.groupIndex].caption,\r\n      captionTxt = caption ? caption : getImageNameFromUrl(url);\r\n\r\n    this.$title.html(captionTxt);\r\n\r\n  }\r\n\r\n  jump(index) {\r\n\r\n    this.groupIndex = this.groupIndex + index;\r\n\r\n    this.jumpTo(this.groupIndex);\r\n\r\n  }\r\n\r\n  jumpTo(index) {\r\n\r\n    index = index % this.groupData.length;\r\n\r\n    if (index >= 0) {\r\n      index = index % this.groupData.length;\r\n    } else if (index < 0) {\r\n      index = (this.groupData.length + index) % this.groupData.length;\r\n    }\r\n\r\n    this.groupIndex = index;\r\n\r\n    this._triggerHook('beforeChange', index);\r\n\r\n    this.loadImg(this.groupData[index].src);\r\n\r\n    this._triggerHook('changed', index);\r\n\r\n  }\r\n\r\n  wheel(e) {\r\n\r\n    e.preventDefault();\r\n\r\n    let delta = 1;\r\n\r\n    if (e.originalEvent.deltaY) {\r\n      delta = e.originalEvent.deltaY > 0 ? 1 : -1;\r\n    } else if (e.originalEvent.wheelDelta) {\r\n      delta = -e.originalEvent.wheelDelta / 120;\r\n    } else if (e.originalEvent.detail) {\r\n      delta = e.originalEvent.detail > 0 ? 1 : -1;\r\n    }\r\n\r\n    // ratio threshold\r\n    let ratio = -delta * this.options.ratioThreshold;\r\n\r\n    // mouse point position relative to stage\r\n    let pointer = {\r\n      x: e.originalEvent.clientX - this.$stage.offset().left + $D.scrollLeft(),\r\n      y: e.originalEvent.clientY - this.$stage.offset().top + $D.scrollTop()\r\n    };\r\n\r\n    this.zoom(ratio, pointer, e);\r\n\r\n  }\r\n\r\n  zoom(ratio, origin, e) {\r\n\r\n    // zoom out & zoom in\r\n    ratio = ratio < 0 ? (1 / (1 - ratio)) : (1 + ratio);\r\n\r\n    if (ratio > 0.95 && ratio < 1.05) {\r\n      ratio = 1;\r\n    }\r\n\r\n    ratio = this.$image.width() / this.imageData.originalWidth * ratio;\r\n\r\n    // min image size\r\n    ratio = Math.max(ratio, this.options.minRatio);\r\n    // max image size\r\n    ratio = Math.min(ratio, this.options.maxRatio);\r\n\r\n    this.zoomTo(ratio, origin, e);\r\n\r\n  }\r\n\r\n  zoomTo(ratio, origin, e) {\r\n\r\n    let $image = this.$image,\r\n      $stage = this.$stage,\r\n      imgData = {\r\n        w: this.imageData.width,\r\n        h: this.imageData.height,\r\n        x: this.imageData.left,\r\n        y: this.imageData.top\r\n      };\r\n\r\n    // image stage position\r\n    // We will use it to calc the relative position of image\r\n    let stageData = {\r\n      w: $stage.width(),\r\n      h: $stage.height(),\r\n      x: $stage.offset().left,\r\n      y: $stage.offset().top\r\n    };\r\n\r\n    let newWidth = this.imageData.originalWidth * ratio,\r\n      newHeight = this.imageData.originalHeight * ratio,\r\n      // Think about it for a while ~~~\r\n      newLeft = origin.x - (origin.x - imgData.x) / imgData.w * newWidth,\r\n      newTop = origin.y - (origin.y - imgData.y) / imgData.h * newHeight;\r\n\r\n    // δ is the difference between image new width and new height\r\n    let δ = !this.isRotated ? 0 : (newWidth - newHeight) / 2,\r\n      imgNewWidth = !this.isRotated ? newWidth : newHeight,\r\n      imgNewHeight = !this.isRotated ? newHeight : newWidth;\r\n\r\n    let offsetX = stageData.w - newWidth,\r\n      offsetY = stageData.h - newHeight;\r\n\r\n    // zoom out & zoom in condition\r\n    // It's important and it takes me a lot of time to get it\r\n    // The conditions with image rotate 90 degree drive me crazy alomst!\r\n    if (imgNewHeight <= stageData.h) {\r\n      newTop = (stageData.h - newHeight) / 2;\r\n    } else {\r\n      newTop = newTop > δ ? δ : (newTop > (offsetY - δ) ? newTop : (offsetY - δ));\r\n    }\r\n\r\n    if (imgNewWidth <= stageData.w) {\r\n      newLeft = (stageData.w - newWidth) / 2;\r\n    } else {\r\n      newLeft = newLeft > -δ ? -δ : (newLeft > (offsetX + δ) ? newLeft : (offsetX + δ));\r\n    }\r\n\r\n    $image.css({\r\n      width: Math.round(newWidth) + 'px',\r\n      height: Math.round(newHeight) + 'px',\r\n      left: Math.round(newLeft) + 'px',\r\n      top: Math.round(newTop) + 'px'\r\n    });\r\n\r\n    // Update image initial data\r\n    $.extend(this.imageData, {\r\n      width: newWidth,\r\n      height: newHeight,\r\n      left: newLeft,\r\n      top: newTop\r\n    });\r\n\r\n    // Set grab cursor\r\n    setGrabCursor({ w: Math.round(imgNewWidth), h: Math.round(imgNewHeight) }, { w: stageData.w, h: stageData.h },\r\n      this.$stage\r\n    );\r\n\r\n  }\r\n\r\n  rotate(angle) {\r\n\r\n    this.rotateAngle = this.rotateAngle + angle;\r\n\r\n    if ((this.rotateAngle / 90) % 2 === 0) {\r\n      this.isRotated = false;\r\n    } else {\r\n      this.isRotated = true;\r\n    }\r\n\r\n    this.rotateTo(this.rotateAngle);\r\n\r\n  }\r\n\r\n  rotateTo(angle) {\r\n\r\n    let self = this;\r\n\r\n    this.$image.css({\r\n      transform: 'rotate(' + angle + 'deg)'\r\n    });\r\n\r\n    this.setImageSize({ width: this.imageData.originalWidth, height: this.imageData.originalHeight });\r\n\r\n    // Remove grab cursor when rotate\r\n    this.$stage.removeClass('is-grab');\r\n\r\n  }\r\n\r\n  resize() {\r\n\r\n    let self = this;\r\n\r\n    let resizeHandler = throttle(function () {\r\n\r\n      if (self.isOpened) {\r\n\r\n        if (self.isMaximized) {\r\n          self.setImageSize({ width: self.imageData.originalWidth, height: self.imageData.originalHeight });\r\n        } else {\r\n          self.setModalSize({ width: self.imageData.originalWidth, height: self.imageData.originalHeight });\r\n        }\r\n\r\n      }\r\n\r\n    }, 500);\r\n\r\n    return resizeHandler;\r\n\r\n  }\r\n\r\n  maximize() {\r\n\r\n    let self = this;\r\n\r\n    if (!this.isMaximized) {\r\n      // Store modal data before maximize\r\n      this.modalData = {\r\n        width: this.$photoviewer.width(),\r\n        height: this.$photoviewer.height(),\r\n        left: this.$photoviewer.offset().left,\r\n        top: this.$photoviewer.offset().top\r\n      };\r\n\r\n      this.$photoviewer.addClass(NS + '-maximize');\r\n\r\n      this.$photoviewer.css({\r\n        width: '100%',\r\n        height: '100%',\r\n        left: 0,\r\n        top: 0\r\n      });\r\n\r\n      this.isMaximized = true;\r\n\r\n    } else {\r\n\r\n      this.$photoviewer.removeClass(NS + '-maximize');\r\n\r\n      this.$photoviewer.css({\r\n        width: this.modalData.width ? this.modalData.width : this.options.modalWidth,\r\n        height: this.modalData.height ? this.modalData.height : this.options.modalHeight,\r\n        left: this.modalData.left ? this.modalData.left : ($W.width() - this.options.modalWidth) / 2 + $D.scrollLeft(),\r\n        top: this.modalData.top ? this.modalData.top : ($W.height() - this.options.modalHeight) / 2 + $D.scrollTop()\r\n      });\r\n\r\n      this.isMaximized = false;\r\n    }\r\n\r\n    this.setImageSize({ width: this.imageData.originalWidth, height: this.imageData.originalHeight });\r\n\r\n  }\r\n\r\n  fullscreen() {\r\n\r\n    requestFullscreen(this.$photoviewer[0]);\r\n\r\n  }\r\n\r\n  keydown(e) {\r\n\r\n    let self = this;\r\n\r\n    if (!this.options.keyboard) {\r\n      return false;\r\n    }\r\n\r\n    let keyCode = e.keyCode || e.which || e.charCode,\r\n      ctrlKey = e.ctrlKey || e.metaKey,\r\n      altKey = e.altKey || e.metaKey;\r\n\r\n    switch (keyCode) {\r\n      // ←\r\n      case 37:\r\n        self.jump(-1);\r\n        break;\r\n      // →\r\n      case 39:\r\n        self.jump(1);\r\n        break;\r\n      // +\r\n      case 187:\r\n        self.zoom(self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n        break;\r\n      // -\r\n      case 189:\r\n        self.zoom(-self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n        break;\r\n      // + Firefox\r\n      case 61:\r\n        self.zoom(self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n        break;\r\n      // - Firefox\r\n      case 173:\r\n        self.zoom(-self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n        break;\r\n      // ctrl + alt + 0\r\n      case 48:\r\n        if (ctrlKey && altKey) {\r\n          self.zoomTo(1, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n        }\r\n        break;\r\n      // ctrl + ,\r\n      case 188:\r\n        if (ctrlKey) {\r\n          self.rotate(-90);\r\n        }\r\n        break;\r\n      // ctrl + .\r\n      case 190:\r\n        if (ctrlKey) {\r\n          self.rotate(90);\r\n        }\r\n        break;\r\n      default:\r\n    }\r\n\r\n  }\r\n\r\n  addEvents() {\r\n\r\n    let self = this;\r\n\r\n    this.$close.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n      self.close();\r\n    });\r\n\r\n    this.$stage.off(WHEEL_EVENT + EVENT_NS).on(WHEEL_EVENT + EVENT_NS, function (e) {\r\n      self.wheel(e);\r\n    });\r\n\r\n    this.$zoomIn.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n      self.zoom(self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n    });\r\n\r\n    this.$zoomOut.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n      self.zoom(-self.options.ratioThreshold * 3, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n    });\r\n\r\n    this.$actualSize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n      self.zoomTo(1, { x: self.$stage.width() / 2, y: self.$stage.height() / 2 }, e);\r\n    });\r\n\r\n    this.$prev.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.jump(-1);\r\n    });\r\n\r\n    this.$fullscreen.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.fullscreen();\r\n    });\r\n\r\n    this.$next.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.jump(1);\r\n    });\r\n\r\n    this.$rotateLeft.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.rotate(-90);\r\n    });\r\n\r\n    this.$rotateRight.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.rotate(90);\r\n    });\r\n\r\n    this.$maximize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\r\n      self.maximize();\r\n    });\r\n\r\n    $D.off(KEYDOWN_EVENT + EVENT_NS).on(KEYDOWN_EVENT + EVENT_NS, function (e) {\r\n      self.keydown(e);\r\n    });\r\n\r\n    $W.on(RESIZE_EVENT + EVENT_NS, self.resize());\r\n\r\n  }\r\n\r\n  _triggerHook(e, data) {\r\n    if (this.options.callbacks[e]) {\r\n      this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\n/**\r\n * Add methods to PhotoViewer\r\n */\r\n$.extend(PhotoViewer.prototype, draggable, movable, resizable);\r\n\r\n/**\r\n * Add PhotoViewer to globle\r\n */\r\nwindow.PhotoViewer = PhotoViewer;\r\n\r\n/**\r\n * jQuery plugin\r\n */\r\n\r\nlet jqEl = null,\r\n  getImgGroup = function (list, groupName) {\r\n\r\n    let items = [];\r\n\r\n    $(list).each(function () {\r\n\r\n      let src = getImgSrc(this);\r\n\r\n      items.push({\r\n        src: src,\r\n        caption: $(this).attr('data-caption'),\r\n        groupName: groupName\r\n      });\r\n\r\n    });\r\n\r\n    return items;\r\n\r\n  }\r\n\r\n$.fn.photoviewer = function (options) {\r\n\r\n  jqEl = $(this);\r\n\r\n  options = options ? options : {};\r\n\r\n  // Convert a numeric string into a number\r\n  for (let key in options) {\r\n    if (typeof (options[key]) === 'string' && !isNaN(options[key])) {\r\n      options[key] = parseFloat(options[key])\r\n    }\r\n  }\r\n\r\n  // Get init event, 'click' or 'dblclick'\r\n  let opts = $.extend(true, {}, DEFAULTS, options);\r\n\r\n  // We should get zIndex of options before plugin's init.\r\n  PUBLIC_VARS['zIndex'] = opts.zIndex;\r\n\r\n  if (typeof options === 'string') {\r\n\r\n    // $(this).data('photoviewer')[options]();\r\n\r\n  } else {\r\n\r\n    jqEl.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n\r\n      e.preventDefault();\r\n      // This will stop triggering data-api event\r\n      e.stopPropagation();\r\n\r\n      // Get image group\r\n      let items = [],\r\n        currentGroupName = $(this).attr('data-group'),\r\n        groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\r\n\r\n      if (currentGroupName !== undefined) {\r\n        items = getImgGroup(groupList, currentGroupName);\r\n        options['index'] = $(this).index('[data-group=\"' + currentGroupName + '\"]');\r\n      } else {\r\n        items = getImgGroup(jqEl.not('[data-group]'));\r\n        options['index'] = $(this).index();\r\n      }\r\n\r\n      $(this).data(NS, new PhotoViewer(items, options, this));\r\n\r\n    });\r\n\r\n  }\r\n\r\n  return jqEl;\r\n\r\n};\r\n\r\n/**\r\n * PhotoViewer DATA-API\r\n */\r\n$D.on(CLICK_EVENT + EVENT_NS, '[data-' + NS + ']', function (e) {\r\n\r\n  jqEl = $('[data-' + NS + ']');\r\n\r\n  e.preventDefault();\r\n\r\n  // Get image group\r\n  let items = [],\r\n    currentGroupName = $(this).attr('data-group'),\r\n    groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\r\n\r\n  if (currentGroupName !== undefined) {\r\n    items = getImgGroup(groupList, currentGroupName);\r\n    DEFAULTS['index'] = $(this).index('[data-group=\"' + currentGroupName + '\"]');\r\n  } else {\r\n    items = getImgGroup(jqEl.not('[data-group]'));\r\n    DEFAULTS['index'] = $(this).index();\r\n  }\r\n\r\n  $(this).data(NS, new PhotoViewer(items, DEFAULTS, this));\r\n\r\n});\r\n\r\nexport default PhotoViewer;\r\n"],"names":["draggable","resizable","movable","keyboard","title","modalWidth","modalHeight","fixedContent","fixedModalSize","initMaximized","gapThreshold","ratioThreshold","minRatio","maxRatio","headToolbar","footToolbar","icons","minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight","i18n","multiInstances","initAnimation","fixedModalPos","zIndex","dragHandle","callbacks","beforeOpen","$","noop","opened","beforeClose","closed","beforeChange","changed","index","getImgSrc","el","src","attr","throttle","fn","delay","timer","context","args","arguments","clearTimeout","setTimeout","apply","preloadImg","success","error","img","Image","onload","onerror","requestFullscreen","element","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","getImageNameFromUrl","url","reg","txt","replace","getNumFromCSSValue","value","arr","match","num","parseFloat","hasScrollbar","document","body","scrollHeight","window","innerHeight","documentElement","clientHeight","getScrollbarWidth","scrollDiv","createElement","style","cssText","appendChild","scrollbarWidth","offsetWidth","clientWidth","removeChild","setGrabCursor","imageData","stageData","stage","isRotated","imageWidth","w","h","imageHeight","addClass","removeClass","supportTouch","DocumentTouch","$W","$D","CLICK_EVENT","RESIZE_EVENT","KEYDOWN_EVENT","WHEEL_EVENT","TOUCH_START_EVENT","TOUCH_MOVE_EVENT","TOUCH_END_EVENT","NS","CLASS_NS","EVENT_NS","PUBLIC_VARS","isMoving","isResizing","defaults","modal","dragCancel","self","isDragging","startX","startY","left","top","dragStart","e","event","options","css","elemCancel","target","closest","length","type","originalEvent","targetTouches","pageX","clientX","pageY","clientY","offset","on","dragMove","dragEnd","preventDefault","isMaximized","endX","endY","relativeX","relativeY","off","ELEMS_WITH_GRABBING_CURSOR","image","widthDiff","heightDiff","δ","width","height","stageWidth","stageHeight","position","hasClass","newLeft","newTop","extend","ELEMS_WITH_RESIZE_CURSOR","minWidth","minHeight","resizableHandleE","resizableHandleW","resizableHandleS","resizableHandleN","resizableHandleSE","resizableHandleSW","resizableHandleNE","resizableHandleNW","resizableHandles","append","modalData","l","t","imgWidth","imgHeight","direction","getModalOpts","dir","offsetX","offsetY","modalLeft","modalTop","opts","Math","max","getImageOpts","widthDiff2","heightDiff2","imgLeft","imgTop","imgLeft2","imgTop2","modalOpts","imageOpts","each","handle","PhotoViewer","items","DEFAULTS","isArray","$el","isOpened","rotateAngle","init","groupData","groupIndex","imgSrc","open","loadImg","$photoviewer","$stage","$image","_creatBtns","toolbar","btns","btnsStr","item","_creatTitle","_creatDOM","btnsTpl","photoviewerHTML","build","$header","find","$headToolbar","$footer","$footToolbar","$title","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","eq","remove","_triggerHook","addEvents","setModalPos","zeroModal","winWidth","winHeight","scrollLeft","scrollTop","setModalSize","stageCSS","right","bottom","borderLeft","borderRight","borderTop","borderBottom","scale","min","round","modalCSSObj","animate","setImageSize","ceil","fadeIn","loaderHTML","hide","originalWidth","originalHeight","setImgTitle","caption","captionTxt","html","jump","jumpTo","wheel","delta","deltaY","wheelDelta","detail","ratio","pointer","x","y","zoom","origin","zoomTo","imgData","newWidth","newHeight","imgNewWidth","imgNewHeight","rotate","angle","rotateTo","transform","resize","resizeHandler","keydown","keyCode","which","charCode","ctrlKey","metaKey","altKey","data","prototype","jqEl","getImgGroup","list","groupName","push","photoviewer","key","isNaN","stopPropagation","currentGroupName","groupList","undefined","not"],"mappings":"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"}