<script>
    $(function () {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var tab = e.target.innerHTML; // newly activated tab
            if (tab === "Hospital") {
                searchHospital(1);
            }
            else if (tab === "Train station") {
                searchTrainStation(1);
            }
            else if (tab === "Bike station") {
                searchBikeStation(1);
            }
            else if (tab === "Weather") {
                searchWeather();
            }
        });
    });
    function searchWeather() {
        var cityName = $("#ddlCity").val();
        if (cityName === '') return false;
        $.ajax({
            type: "GET",
            url: 'https://api.openweathermap.org/data/2.5/weather?q=' + cityName +'&lang=en&units=metric&appid=ae133d7fc3811a3ba7592bfdb2bd1b75',
            data: {},
            beforeSend: function () {
            }
        }).done(function (data) {
            if (data !== null && data !== undefined) {
                $("#wCity").html(cityName);
                $("#wImg").attr("src", "http://openweathermap.org/img/w/" + data.weather[0].icon + ".png");
                $("#wDoAm").html(data.main.humidity);
                $("#wSucGio").html(data.wind.speed);
                $("#wMaxNhietDo").html(data.main.temp_max);
                $("#wMinNhietDo").html(data.main.temp_min);
                $("#wDescription").html(data.weather[0].description);
            }
        }).fail(function (jqXHR, textStatus) {
        });
    };
    function searchTrainStation(pageId) {
        var cityName = $("#ddlCity").val();
        if (cityName === "") return false;
        $("#nav-train").html("");

        $.ajax({
            type: "POST",
            url: '@Url.Action("SearchTrainStation","Home")',
            data: { cityName: cityName, page: pageId, pageSize: 30},
            beforeSend: function () {
            }
        }).done(function (data) {
            $("#nav-train").html(data);
        }).fail(function (jqXHR, textStatus) {
        });
    };

    function searchBikeStation(pageId) {
        var cityName = $("#ddlCity").val();
        if (cityName === "") return false;
        $("#nav-bike").html("");

        $.ajax({
            type: "POST",
            url: '@Url.Action("SearchBikeStatation","Home")',
            data: { cityName: cityName, page: pageId, pageSize: 30},
            beforeSend: function () {
            }
        }).done(function (data) {
            $("#nav-bike").html(data);
        }).fail(function (jqXHR, textStatus) {
        });
    };


    function searchHospital(pageId) {
        var cityName = $("#ddlCity").val();
        if (cityName === "") return false;
        $("#nav-hospital").html("");

        $.ajax({
            type: "POST",
            url: '@Url.Action("SearchHospital","Home")',
            data: { cityName: cityName, page: pageId, pageSize: 30},
            beforeSend: function () {
            }
        }).done(function (data) {
            $("#nav-hospital").html(data);
        }).fail(function (jqXHR, textStatus) {
        });
    };
</script>
